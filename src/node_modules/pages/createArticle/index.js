import React, { useEffect, useState, useContext } from "react";
import ArticleForm from "components/articleForm";
import useFetch from "hooks/useFetch";
import { Navigate } from "react-router-dom";
import { CurrentUserContext } from "contexts/currentUser";

const CreateArticle = () => {
  const apiUrl = "/articles";
  const [isSuccessfullSubmit, setIsSuccessfullSubmit] = useState( false );
  const [{response, error}, doFetch] = useFetch( apiUrl );
  const [currentUserState] = useContext( CurrentUserContext );

  const handleSubmit = ( article ) => {
    console.log( "handleSubmit", article );
    doFetch( {
      method: "post",
      data: {
        article
      }
    } );
  };

  const initialValues = {
    title: "",
    description: "",
    body: "",
    tagList: ""
  };

  useEffect( () => {
    if ( !response ) {
      return;
    }
    setIsSuccessfullSubmit( true );
  }, [response] );

  if (currentUserState.isLoggedIn === null) {
    return null
  }

  if ( isSuccessfullSubmit || currentUserState.isLoggedIn === false ) {
    return (
        <Navigate to="/"/>
    );
  }

  return (
      <div>
        <ArticleForm
            initialValues={initialValues}
            onSubmit={handleSubmit}
            errors={(error && error.errors) || {}}
        />
      </div>);
};

export default CreateArticle;