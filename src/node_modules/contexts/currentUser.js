import { createContext, useReducer } from "react";
import React from "react";

const initialState = {
  // загружаем юзера или нет
  isLoading: false,
  // 3 состояния null - мы не знаем загружен юзер или нет. false \ true - загрузка юзера
  isLoggedIn: null,
  // response от бэкенда , заменяем null на объект user при получении данных с сервера
  currentUser: null
};


const reducer = ( state, action ) => {
  switch ( action.type ) {
    case "LOADING":
      return {...state, isLoading: true};
    case "SET_AUTHORIZED":
      return {
        ...state,
        isLoggedIn: true,
        isLoading: true,
        currentUser: action.payload
      };
    case "SET_UNAUTHORIZED":
      return {
        ...state,
        isLoggedIn: false
      };
    case "LOGOUT":
      return {
        ...initialState,
        isLoggedIn: false
      }
    default:
      return state
  }
};

export const CurrentUserContext = createContext();

// обертка для использования контекста CurrentUserContext
export const CurrentUserProvider = ( {children} ) => {
  const value = useReducer( reducer, initialState );
  return (
      // Передаем в обертку состояние state и сеттер setState для обновления
      <CurrentUserContext.Provider value={value}>
        {children}
      </CurrentUserContext.Provider>
  );
};